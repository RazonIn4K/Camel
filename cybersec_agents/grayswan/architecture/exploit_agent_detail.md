# Exploit Delivery Agent - Detailed Architecture

This diagram provides a detailed view of the Exploit Delivery Agent's internal architecture, showing how it handles both API-based testing and browser automation workflows.

```mermaid
flowchart TB
    %% Color definitions
    classDef coreComponent fill:#f9f,stroke:#333,stroke-width:2px
    classDef externalService fill:#fbb,stroke:#333,stroke-width:1px
    classDef dataProcessor fill:#bbf,stroke:#333,stroke-width:1px
    classDef dataStorage fill:#bfb,stroke:#333,stroke-width:1px
    classDef asyncProcess fill:#ffb,stroke:#333,stroke-width:1px
    classDef bottleneck fill:#fbb,stroke:#f00,stroke-width:3px,stroke-dasharray: 5 5
    classDef decision fill:#ffe,stroke:#333,stroke-width:1px

    %% Main component
    ExploitAgent[Exploit Delivery Agent]:::coreComponent
    
    %% Core subcomponents
    subgraph ExploitComponents["Internal Components"]
        PromptLoader[Prompt Loader]:::dataProcessor
        MethodSelector[Testing Method Selector]:::decision
        ResultsAnalyzer[Results Analyzer]:::dataProcessor
        Reporter[Results Reporter]:::dataProcessor
        
        subgraph ApiTesting["API-Based Testing"]
            ApiExecutor[API Executor]:::dataProcessor
            BatchManager[Concurrent Batch Manager]:::asyncProcess
            RateLimiter[Rate Limiter]:::dataProcessor
            ResponseParser[Response Parser]:::dataProcessor
        end
        
        subgraph BrowserTesting["Browser Automation"]
            AutomationFactory[Automation Factory]:::decision
            BrowserManager[Browser Manager]:::dataProcessor
            
            subgraph PlaywrightModule["Playwright Module"]
                PlaywrightDriver[Playwright Driver]:::dataProcessor
                PlaywrightSelectors[Selector Manager]:::dataProcessor
            end
            
            subgraph SeleniumModule["Selenium Module"]
                SeleniumDriver[Selenium Driver]:::dataProcessor
                SeleniumSelectors[Selector Manager]:::dataProcessor
            end
        end
    end
    
    %% External Services
    subgraph ExternalServices["External Services"]
        LLMApis[LLM APIs]:::externalService
        PlaywrightBrowsers[Playwright Browsers]:::externalService
        SeleniumBrowsers[Selenium Browsers]:::externalService
    end
    
    %% Storage
    PromptDB[(Prompt Storage)]:::dataStorage
    ResultsDB[(Results Storage)]:::dataStorage
    
    %% Input sources
    Config([Configuration])
    
    %% Flow within the agent - Initial setup
    Config --> ExploitAgent
    ExploitAgent --> PromptLoader
    PromptLoader --> MethodSelector
    PromptLoader --> PromptDB
    
    %% Method selection logic
    MethodSelector -- "API Testing" --> ApiExecutor
    MethodSelector -- "Browser Testing" --> AutomationFactory
    
    %% API Testing Flow
    ApiExecutor --> BatchManager
    BatchManager --> RateLimiter
    RateLimiter -- "Sequential Calls" --> LLMApis
    LLMApis -- "Responses" --> ResponseParser
    BatchManager -- "Manages Concurrency" --> RateLimiter
    ResponseParser --> ResultsAnalyzer
    
    %% Browser Automation Factory
    AutomationFactory -- "Playwright Selected" --> PlaywrightDriver
    AutomationFactory -- "Selenium Selected" --> SeleniumDriver
    
    %% Playwright flow
    PlaywrightDriver --> BrowserManager
    PlaywrightDriver -- "Launches" --> PlaywrightBrowsers
    PlaywrightSelectors -- "Provides Selectors" --> PlaywrightDriver
    PlaywrightBrowsers -- "Page Events" --> PlaywrightDriver
    
    %% Selenium flow
    SeleniumDriver --> BrowserManager
    SeleniumDriver -- "Launches" --> SeleniumBrowsers
    SeleniumSelectors -- "Provides Selectors" --> SeleniumDriver
    SeleniumBrowsers -- "Element Events" --> SeleniumDriver
    
    %% Results handling
    PlaywrightDriver -- "Execution Results" --> BrowserManager
    SeleniumDriver -- "Execution Results" --> BrowserManager
    BrowserManager -- "Aggregated Results" --> ResultsAnalyzer
    
    %% Reporting
    ResultsAnalyzer --> Reporter
    Reporter -- "Saves Results" --> ResultsDB
    Reporter -- "Returns Results" --> ExploitAgent
    
    %% Highlight bottlenecks
    RateLimiter:::bottleneck
    LLMApis:::bottleneck
    BrowserManager:::bottleneck
```

## Agent Architecture Components

### Core Components
- **Exploit Delivery Agent**: Main agent coordinating the exploit testing process
- **Prompt Loader**: Loads prompt lists from storage
- **Method Selector**: Decides between API-based testing and browser automation
- **Results Analyzer**: Analyzes test results to determine success rates
- **Reporter**: Generates detailed reports on test results

### API Testing Components
- **API Executor**: Manages the API-based testing workflow
- **Batch Manager**: Handles concurrent execution of multiple prompts
- **Rate Limiter**: Controls request rates to avoid API throttling
- **Response Parser**: Parses and analyzes model responses

### Browser Automation Components
- **Automation Factory**: Selects and initializes the appropriate browser automation library
- **Browser Manager**: Coordinates browser interactions and result collection
- **Playwright Module**: Implements browser automation using Playwright
- **Selenium Module**: Alternative implementation using Selenium WebDriver

## Critical Flows

### API Testing Flow
1. Load prompts from storage
2. Select API testing method
3. Configure the API executor with model parameters
4. Process prompts in concurrent batches with rate limiting
5. Send requests to LLM APIs
6. Parse and analyze responses
7. Generate and store results

### Browser Automation Flow
1. Load prompts from storage
2. Select browser automation method (Playwright or Selenium)
3. Initialize the appropriate browser driver
4. Configure selectors for the target web interface
5. Execute prompts through the browser interface
6. Collect and process responses
7. Generate and store results

## Bottlenecks & Complexities

### Performance Bottlenecks
- **Rate Limiting**: API rate limits can slow down testing
- **Browser Automation**: Browser interaction is slower than direct API calls
- **Response Processing**: Parsing complex responses requires significant processing

### Key Decision Points
- **Method Selection**: Choosing between API and browser testing
- **Automation Library**: Selecting Playwright or Selenium based on compatibility
- **Concurrency Management**: Balancing performance with rate limits

## Integration Points
- **Configuration**: Environment variables for API keys and settings
- **Prompt Storage**: Loading prompt lists from storage
- **Results Storage**: Saving test results for evaluation
- **External Services**: Interaction with LLM APIs and browsers 